<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin - SIRESU</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-r from-indigo-500 to-purple-600 min-h-screen p-6">

<div class="container mx-auto bg-white rounded-2xl shadow-xl p-6">

  <h1 class="text-3xl font-bold text-center text-indigo-700 mb-8">
    Panel de Administraci√≥n - SIRESU
  </h1>

  <!-- ====== CREAR USUARIO ====== -->
  <div class="bg-gray-100 p-6 rounded-xl mb-8">
    <h2 class="text-xl font-bold mb-4">Crear Usuario</h2>

    <div class="grid md:grid-cols-3 gap-4">
      <input id="newCorreo" type="email" placeholder="Correo"
        class="border p-2 rounded">

      <input id="newPassword" type="password" placeholder="Contrase√±a"
        class="border p-2 rounded">

      <select id="newRol" class="border p-2 rounded">
        <option value="cliente">Cliente</option>
        <option value="admin">Admin</option>
      </select>
    </div>

    <button onclick="crearUsuario()"
      class="mt-4 bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">
      Crear Usuario
    </button>
  </div>

  <!-- ====== USUARIOS ====== -->
  <div class="bg-gray-100 p-6 rounded-xl mb-8">
    <h2 class="text-xl font-bold mb-4">Usuarios</h2>

    <table class="w-full border">
      <thead class="bg-indigo-200">
        <tr>
          <th class="border p-2">Correo</th>
          <th class="border p-2">Contrase√±a</th>
          <th class="border p-2">Rol</th>
          <th class="border p-2">Acciones</th>
        </tr>
      </thead>
      <tbody id="tablaUsuarios"></tbody>
    </table>
  </div>

  <!-- ====== RECLAMOS ====== -->
  <div class="bg-gray-100 p-6 rounded-xl">
    <h2 class="text-xl font-bold mb-4">Reclamos</h2>

    <table class="w-full border">
      <thead class="bg-indigo-200">
        <tr>
          <th class="border p-2">Tipo</th>
          <th class="border p-2">Descripci√≥n</th>
          <th class="border p-2">Correo</th>
          <th class="border p-2">Estado</th>
        </tr>
      </thead>
      <tbody id="tablaReclamos"></tbody>
    </table>
  </div>

</div>

<script>
const API = "https://siresu1.onrender.com";

// ================= USUARIOS =================

async function cargarUsuarios() {
  const res = await fetch(`${API}/usuarios`);
  const usuarios = await res.json();
  const tabla = document.getElementById("tablaUsuarios");
  tabla.innerHTML = "";

  usuarios.forEach(u => {
    tabla.innerHTML += `
      <tr>
        <td class="border p-2">${u.id}</td>

        <td class="border p-2">
          <div class="flex gap-2">
            <input type="password" value="${u.password}"
              id="pass-${u.id}" disabled class="border p-1 w-full rounded">
            <button onclick="togglePass('${u.id}')">üëÅÔ∏è</button>
          </div>
        </td>

        <td class="border p-2">
          <select id="rol-${u.id}" disabled class="border p-1 rounded w-full">
            <option ${u.role === "cliente" ? "selected" : ""}>cliente</option>
            <option ${u.role === "admin" ? "selected" : ""}>admin</option>
          </select>
        </td>

        <td class="border p-2 space-x-1">
          <button onclick="habilitar('${u.id}')"
            class="bg-yellow-500 text-white px-2 py-1 rounded">Editar</button>

          <button onclick="actualizarUsuario('${u.id}')"
            class="bg-green-600 text-white px-2 py-1 rounded">Actualizar</button>

          <button onclick="eliminarUsuario('${u.id}')"
            class="bg-red-600 text-white px-2 py-1 rounded">Eliminar</button>
        </td>
      </tr>
    `;
  });
}

function habilitar(correo) {
  document.getElementById(`pass-${correo}`).disabled = false;
  document.getElementById(`rol-${correo}`).disabled = false;
}

function togglePass(correo) {
  const input = document.getElementById(`pass-${correo}`);
  input.type = input.type === "password" ? "text" : "password";
}

async function actualizarUsuario(correo) {
  if (!confirm("¬øDeseas actualizar este usuario?")) return;
  if (!confirm("CONFIRMACI√ìN FINAL")) return;

  const password = document.getElementById(`pass-${correo}`).value;
  const rol = document.getElementById(`rol-${correo}`).value;

  const res = await fetch(`${API}/usuarios/${correo}`, {
    method: "PATCH",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ correo, password, rol })
  });

  const data = await res.json();
  alert(data.message || "Actualizado");
  cargarUsuarios();
}

async function eliminarUsuario(correo) {
  if (!confirm("¬øEliminar usuario y reclamos?")) return;

  await fetch(`${API}/usuarios/${correo}`, { method: "DELETE" });
  cargarUsuarios();
}

async function crearUsuario() {
  const correo = newCorreo.value;
  const password = newPassword.value;
  const rol = newRol.value;

  const res = await fetch(`${API}/crear-usuario`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ correo, password, rol })
  });

  const data = await res.json();
  alert(data.message || data.error);
  cargarUsuarios();
}

// ================= RECLAMOS =================

async function cargarReclamos() {
  const res = await fetch(`${API}/api/reclamos`);
  const reclamos = await res.json();
  const tabla = document.getElementById("tablaReclamos");
  tabla.innerHTML = "";

  reclamos.forEach(r => {
    tabla.innerHTML += `
      <tr>
        <td class="border p-2">${r.tipo}</td>
        <td class="border p-2">${r.descripcion}</td>
        <td class="border p-2">${r.correo}</td>
        <td class="border p-2">${r.estado}</td>
      </tr>
    `;
  });
}

cargarUsuarios();
cargarReclamos();
</script>

</body>
</html>
